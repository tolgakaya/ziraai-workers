
2025-12-06T14:11:43.857648479Z [inf]  [SMS DI] ========================================
2025-12-06T14:11:43.857658861Z [inf]  2025-12-06 14:11:41.844 +00:00 [INF] [RegisterWithPhone] Registration OTP requested for phone: 05421396386
2025-12-06T14:11:43.857665899Z [inf]  2025-12-06 14:11:42.094 +00:00 [INF] [RegisterWithPhone] Sending OTP 299972 to 05421396386 via SMS service
2025-12-06T14:11:43.857671948Z [inf]  2025-12-06 14:11:42.096 +00:00 [INF] Sending OTP to 905421396386 via NetGSM OTP endpoint
2025-12-06T14:11:43.857677889Z [inf]  2025-12-06 14:11:42.364 +00:00 [ERR] OTP sending failed to 905421396386. Error: <?xml - Bilinmeyen hata kodu: <?xml
2025-12-06T14:11:43.857683517Z [inf]  2025-12-06 14:11:42.366 +00:00 [ERR] [RegisterWithPhone] SMS sending failed: OTP gÃ¶nderilemedi: Bilinmeyen hata kodu: <?xml (Kod: <?xml)
2025-12-06T14:11:43.857688256Z [inf]  2025-12-06 14:11:42.393 +00:00 [INF] [RegisterWithPhone] OTP saved to database for phone: 05421396386
2025-12-06T14:11:43.857758588Z [inf]  [AUTOFAC] ConnectionString from config: Host=postgres.railway.internal;Port=5432;Database=...
2025-12-06T14:11:43.857763309Z [inf]  [SMS DI] ========================================
2025-12-06T14:11:43.857769776Z [inf]  [SMS DI] Environment: Production
2025-12-06T14:11:43.857774838Z [inf]  [SMS DI] Direct env var (SmsService__Provider): Netgsm
2025-12-06T14:11:43.857779985Z [inf]  [SMS DI] Config value (SmsService:Provider): Netgsm
2025-12-06T14:11:43.857785138Z [inf]  [SMS DI] Selected provider (lowercase): netgsm
2025-12-06T14:11:44.829921044Z [inf]     at MediatR.Wrappers.RequestHandlerWrapperImpl`2.<>c__DisplayClass1_0.<Handle>g__Handler|0(CancellationToken t)
2025-12-06T14:11:44.829938868Z [inf]  [AUTOFAC] ConnectionString from config: Host=postgres.railway.internal;Port=5432;Database=...
2025-12-06T14:11:44.829945474Z [inf]  2025-12-06 14:11:44.681 +00:00 [INF] [VerifyPhoneRegister] Verifying OTP for phone: 05421396386
2025-12-06T14:11:44.829951814Z [inf]  2025-12-06 14:11:44.684 +00:00 [INF] [VerifyPhoneRegister] Looking for OTP - Phone: 05421396386, Code: 299972, Provider: Phone
2025-12-06T14:11:44.829960303Z [inf]     at Core.Utilities.Interceptors.MethodInterception.Intercept(IInvocation invocation) in /src/Core/Utilities/Interceptors/MethodInterception.cs:line 15
2025-12-06T14:11:44.829965241Z [inf]     at Castle.DynamicProxy.AbstractInvocation.Proceed()
2025-12-06T14:11:44.829967212Z [inf]     at Castle.DynamicProxy.AbstractInvocation.Proceed()
2025-12-06T14:11:44.829977371Z [inf]     at Core.Utilities.Interceptors.MethodInterception.Intercept(IInvocation invocation) in /src/Core/Utilities/Interceptors/MethodInterception.cs:line 15
2025-12-06T14:11:44.829978337Z [inf]     at Castle.Proxies.IRequestHandler`2Proxy_19.Handle(VerifyPhoneRegisterCommand request, CancellationToken cancellationToken)
2025-12-06T14:11:44.829986607Z [inf]     at Castle.DynamicProxy.AbstractInvocation.Proceed()
2025-12-06T14:11:44.830002823Z [inf]  2025-12-06 14:11:44.734 +00:00 [ERR] Exception occurred: One or more errors occurred. (An error occurred while saving the entity changes. See the inner exception for details.) at /api/v1/auth/verify-phone-register POST. StackTrace:    at System.Threading.Tasks.Task.ThrowIfExceptional(Boolean includeTaskCanceledExceptions)
2025-12-06T14:11:44.830008559Z [inf]     at System.Threading.Tasks.Task.Wait(Int32 millisecondsTimeout, CancellationToken cancellationToken)
2025-12-06T14:11:44.830014059Z [inf]     at Core.Utilities.Interceptors.MethodInterception.Intercept(IInvocation invocation) in /src/Core/Utilities/Interceptors/MethodInterception.cs:line 16
2025-12-06T14:11:44.832726059Z [inf]     at MediatR.Wrappers.RequestHandlerWrapperImpl`2.Handle(IRequest`1 request, IServiceProvider serviceProvider, CancellationToken cancellationToken)
2025-12-06T14:11:44.832729755Z [inf]     at MediatR.Mediator.Send[TResponse](IRequest`1 request, CancellationToken cancellationToken)
2025-12-06T14:11:44.832733483Z [inf]     at WebAPI.Controllers.AuthController.VerifyPhoneRegister(VerifyPhoneRegisterRequest request) in /src/WebAPI/Controllers/AuthController.cs:line 237
2025-12-06T14:11:44.832737229Z [inf]     at Microsoft.AspNetCore.Mvc.Infrastructure.ActionMethodExecutor.TaskOfIActionResultExecutor.Execute(ActionContext actionContext, IActionResultTypeMapper mapper, ObjectMethodExecutor executor, Object controller, Object[] arguments)
2025-12-06T14:11:44.832741286Z [inf]     at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.<InvokeActionMethodAsync>g__Awaited|12_0(ControllerActionInvoker invoker, ValueTask`1 actionResultValueTask)
2025-12-06T14:11:44.832745386Z [inf]     at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.<InvokeNextActionFilterAsync>g__Awaited|10_0(ControllerActionInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)
2025-12-06T14:11:44.832749245Z [inf]     at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.Rethrow(ActionExecutedContextSealed context)
2025-12-06T14:11:44.832754937Z [inf]     at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.Next(State& next, Scope& scope, Object& state, Boolean& isCompleted)
2025-12-06T14:11:44.832758816Z [inf]     at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.InvokeInnerFilterAsync()
2025-12-06T14:11:44.832762508Z [inf]  --- End of stack trace from previous location ---
2025-12-06T14:11:44.832766450Z [inf]     at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeNextResourceFilter>g__Awaited|25_0(ResourceInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)
2025-12-06T14:11:44.832881683Z [inf]     at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.Rethrow(ResourceExecutedContextSealed context)
2025-12-06T14:11:44.832891823Z [inf]     at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.Next(State& next, Scope& scope, Object& state, Boolean& isCompleted)
2025-12-06T14:11:44.832896681Z [inf]     at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.InvokeFilterPipelineAsync()
2025-12-06T14:11:44.832901388Z [inf]  --- End of stack trace from previous location ---
2025-12-06T14:11:44.832906455Z [inf]     at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeAsync>g__Awaited|17_0(ResourceInvoker invoker, Task task, IDisposable scope)
2025-12-06T14:11:44.832911533Z [inf]     at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeAsync>g__Awaited|17_0(ResourceInvoker invoker, Task task, IDisposable scope)
2025-12-06T14:11:44.832916494Z [inf]     at Microsoft.AspNetCore.Localization.RequestLocalizationMiddleware.Invoke(HttpContext context)
2025-12-06T14:11:44.832921416Z [inf]     at Microsoft.AspNetCore.Authorization.AuthorizationMiddleware.Invoke(HttpContext context)
2025-12-06T14:11:44.832928995Z [inf]     at Microsoft.AspNetCore.Authentication.AuthenticationMiddleware.Invoke(HttpContext context)
2025-12-06T14:11:44.832934525Z [inf]     at Core.Extensions.ExceptionMiddleware.InvokeAsync(HttpContext httpContext) in /src/Core/Extensions/ExceptionMiddleware.cs:line 28
2025-12-06T14:11:44.832939604Z [inf]  System.AggregateException: One or more errors occurred. (An error occurred while saving the entity changes. See the inner exception for details.)
2025-12-06T14:11:44.832944931Z [inf]   ---> Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while saving the entity changes. See the inner exception for details.
2025-12-06T14:11:44.832949902Z [inf]   ---> Npgsql.PostgresException (0x80004005): 23505: duplicate key value violates unique constraint "PK_Users"
2025-12-06T14:11:44.833695728Z [inf]  
2025-12-06T14:11:44.833701110Z [inf]  DETAIL: Detail redacted as it may contain sensitive data. Specify 'Include Error Detail' in the connection string to include this information.
2025-12-06T14:11:44.833705423Z [inf]     at Npgsql.Internal.NpgsqlConnector.ReadMessageLong(Boolean async, DataRowLoadingMode dataRowLoadingMode, Boolean readingNotifications, Boolean isReadingPrependedMessage)
2025-12-06T14:11:44.833802280Z [inf]     at System.Runtime.CompilerServices.PoolingAsyncValueTaskMethodBuilder`1.StateMachineBox`1.System.Threading.Tasks.Sources.IValueTaskSource<TResult>.GetResult(Int16 token)
2025-12-06T14:11:44.833810228Z [inf]     at Npgsql.NpgsqlDataReader.NextResult(Boolean async, Boolean isConsuming, CancellationToken cancellationToken)
2025-12-06T14:11:44.833814480Z [inf]     at Npgsql.NpgsqlDataReader.NextResult(Boolean async, Boolean isConsuming, CancellationToken cancellationToken)
2025-12-06T14:11:44.833818279Z [inf]     at Npgsql.NpgsqlCommand.ExecuteReader(Boolean async, CommandBehavior behavior, CancellationToken cancellationToken)
2025-12-06T14:11:44.833822108Z [inf]     at Npgsql.NpgsqlCommand.ExecuteReader(Boolean async, CommandBehavior behavior, CancellationToken cancellationToken)
2025-12-06T14:11:44.833825825Z [inf]     at Npgsql.NpgsqlCommand.ExecuteDbDataReaderAsync(CommandBehavior behavior, CancellationToken cancellationToken)
2025-12-06T14:11:44.833829626Z [inf]     at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
2025-12-06T14:11:44.833833495Z [inf]     at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
2025-12-06T14:11:44.833840007Z [inf]     at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
2025-12-06T14:11:44.836021433Z [inf]    Exception data:
2025-12-06T14:11:44.836024294Z [inf]     at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
2025-12-06T14:11:44.836029444Z [inf]      Severity: ERROR
2025-12-06T14:11:44.836035981Z [inf]      SqlState: 23505
2025-12-06T14:11:44.836041010Z [inf]      MessageText: duplicate key value violates unique constraint "PK_Users"
2025-12-06T14:11:44.836045807Z [inf]      Detail: Detail redacted as it may contain sensitive data. Specify 'Include Error Detail' in the connection string to include this information.
2025-12-06T14:11:44.836048033Z [inf]      File: nbtinsert.c
2025-12-06T14:11:44.836052003Z [inf]      SchemaName: public
2025-12-06T14:11:44.836057153Z [inf]      TableName: Users
2025-12-06T14:11:44.836059217Z [inf]      Line: 666
2025-12-06T14:11:44.836062086Z [inf]      ConstraintName: PK_Users
2025-12-06T14:11:44.836068433Z [inf]      Routine: _bt_check_unique
2025-12-06T14:11:44.836073707Z [inf]     --- End of inner exception stack trace ---
2025-12-06T14:11:44.836079209Z [inf]     at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
2025-12-06T14:11:44.836085611Z [inf]     at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
2025-12-06T14:11:44.836092315Z [inf]     at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
2025-12-06T14:11:44.836099025Z [inf]     at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
2025-12-06T14:11:44.836106012Z [inf]     at Microsoft.EntityFrameworkCore.Storage.RelationalDatabase.SaveChangesAsync(IList`1 entries, CancellationToken cancellationToken)
2025-12-06T14:11:44.837275644Z [inf]     at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
2025-12-06T14:11:44.837283506Z [inf]     at Npgsql.EntityFrameworkCore.PostgreSQL.Storage.Internal.NpgsqlExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
2025-12-06T14:11:44.837290374Z [inf]     at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
2025-12-06T14:11:44.837295474Z [inf]     at Castle.DynamicProxy.AbstractInvocation.Proceed()
2025-12-06T14:11:44.837296962Z [inf]     at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
2025-12-06T14:11:44.837303328Z [inf]     at Business.Handlers.Authorizations.Commands.VerifyPhoneRegisterCommand.VerifyPhoneRegisterCommandHandler.Handle(VerifyPhoneRegisterCommand request, CancellationToken cancellationToken) in /src/Business/Handlers/Authorizations/Commands/VerifyPhoneRegisterCommand.cs:line 145
2025-12-06T14:11:44.837305723Z [inf]     at Core.Utilities.Interceptors.MethodInterception.Intercept(IInvocation invocation) in /src/Core/Utilities/Interceptors/MethodInterception.cs:line 15
2025-12-06T14:11:44.837310407Z [inf]     --- End of inner exception stack trace ---
2025-12-06T14:11:44.837315677Z [inf]     at System.Threading.Tasks.Task.ThrowIfExceptional(Boolean includeTaskCanceledExceptions)
2025-12-06T14:11:44.837320904Z [inf]     at System.Threading.Tasks.Task.Wait(Int32 millisecondsTimeout, CancellationToken cancellationToken)
2025-12-06T14:11:44.837324894Z [inf]     at Core.Utilities.Interceptors.MethodInterception.Intercept(IInvocation invocation) in /src/Core/Utilities/Interceptors/MethodInterception.cs:line 16
2025-12-06T14:11:44.839197633Z [inf]     at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.<InvokeNextActionFilterAsync>g__Awaited|10_0(ControllerActionInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)
2025-12-06T14:11:44.839207191Z [inf]     at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.Rethrow(ActionExecutedContextSealed context)
2025-12-06T14:11:44.839228418Z [inf]     at Castle.DynamicProxy.AbstractInvocation.Proceed()
2025-12-06T14:11:44.839237860Z [inf]     at Core.Utilities.Interceptors.MethodInterception.Intercept(IInvocation invocation) in /src/Core/Utilities/Interceptors/MethodInterception.cs:line 15
2025-12-06T14:11:44.839243241Z [inf]     at Castle.DynamicProxy.AbstractInvocation.Proceed()
2025-12-06T14:11:44.839270312Z [inf]     at Castle.Proxies.IRequestHandler`2Proxy_19.Handle(VerifyPhoneRegisterCommand request, CancellationToken cancellationToken)
2025-12-06T14:11:44.839276100Z [inf]     at MediatR.Wrappers.RequestHandlerWrapperImpl`2.<>c__DisplayClass1_0.<Handle>g__Handler|0(CancellationToken t)
2025-12-06T14:11:44.839280507Z [inf]     at MediatR.Wrappers.RequestHandlerWrapperImpl`2.Handle(IRequest`1 request, IServiceProvider serviceProvider, CancellationToken cancellationToken)
2025-12-06T14:11:44.839285414Z [inf]     at MediatR.Mediator.Send[TResponse](IRequest`1 request, CancellationToken cancellationToken)
2025-12-06T14:11:44.839290984Z [inf]     at WebAPI.Controllers.AuthController.VerifyPhoneRegister(VerifyPhoneRegisterRequest request) in /src/WebAPI/Controllers/AuthController.cs:line 237
2025-12-06T14:11:44.839296399Z [inf]     at Microsoft.AspNetCore.Mvc.Infrastructure.ActionMethodExecutor.TaskOfIActionResultExecutor.Execute(ActionContext actionContext, IActionResultTypeMapper mapper, ObjectMethodExecutor executor, Object controller, Object[] arguments)
2025-12-06T14:11:44.839300805Z [inf]     at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.<InvokeActionMethodAsync>g__Awaited|12_0(ControllerActionInvoker invoker, ValueTask`1 actionResultValueTask)
2025-12-06T14:11:44.840724089Z [inf]     at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.Next(State& next, Scope& scope, Object& state, Boolean& isCompleted)
2025-12-06T14:11:44.840730777Z [inf]     at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.InvokeInnerFilterAsync()
2025-12-06T14:11:44.840736707Z [inf]  --- End of stack trace from previous location ---
2025-12-06T14:11:44.840741644Z [inf]     at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeNextResourceFilter>g__Awaited|25_0(ResourceInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)
2025-12-06T14:11:44.840746547Z [inf]     at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.Rethrow(ResourceExecutedContextSealed context)
2025-12-06T14:11:44.840751547Z [inf]     at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.Next(State& next, Scope& scope, Object& state, Boolean& isCompleted)
2025-12-06T14:11:44.840755515Z [inf]     at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.InvokeFilterPipelineAsync()
2025-12-06T14:11:44.840759960Z [inf]  --- End of stack trace from previous location ---
2025-12-06T14:11:44.840764276Z [inf]     at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeAsync>g__Awaited|17_0(ResourceInvoker invoker, Task task, IDisposable scope)
2025-12-06T14:11:44.840768924Z [inf]     at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeAsync>g__Awaited|17_0(ResourceInvoker invoker, Task task, IDisposable scope)
2025-12-06T14:11:44.840773486Z [inf]     at Microsoft.AspNetCore.Localization.RequestLocalizationMiddleware.Invoke(HttpContext context)
2025-12-06T14:11:44.840778190Z [inf]     at Microsoft.AspNetCore.Authorization.AuthorizationMiddleware.Invoke(HttpContext context)
2025-12-06T14:11:44.840782227Z [inf]     at Microsoft.AspNetCore.Authentication.AuthenticationMiddleware.Invoke(HttpContext context)
2025-12-06T14:11:44.840786689Z [inf]     at Core.Extensions.ExceptionMiddleware.InvokeAsync(HttpContext httpContext) in /src/Core/Extensions/ExceptionMiddleware.cs:line 28
2025-12-06T14:11:44.842058851Z [inf]  2025-12-06 14:11:44.740 +00:00 [ERR] Unhandled exception: AggregateException - One or more errors occurred. (An error occurred while saving the entity changes. See the inner exception for details.)
2025-12-06T14:11:52.880933398Z [inf]  2025-12-06 14:11:52.683 +00:00 [INF] [VerifyPhoneRegister] Looking for OTP - Phone: 05421396386, Code: 299972, Provider: Phone
2025-12-06T14:11:52.880934274Z [inf]     at Core.Utilities.Interceptors.MethodInterception.Intercept(IInvocation invocation) in /src/Core/Utilities/Interceptors/MethodInterception.cs:line 15
2025-12-06T14:11:52.880941208Z [inf]  2025-12-06 14:11:52.693 +00:00 [ERR] Exception occurred: One or more errors occurred. (An error occurred while saving the entity changes. See the inner exception for details.) at /api/v1/auth/verify-phone-register POST. StackTrace:    at System.Threading.Tasks.Task.ThrowIfExceptional(Boolean includeTaskCanceledExceptions)
2025-12-06T14:11:52.880943112Z [inf]     at Castle.DynamicProxy.AbstractInvocation.Proceed()
2025-12-06T14:11:52.880947697Z [inf]     at System.Threading.Tasks.Task.Wait(Int32 millisecondsTimeout, CancellationToken cancellationToken)
2025-12-06T14:11:52.880949980Z [inf]     at Castle.Proxies.IRequestHandler`2Proxy_19.Handle(VerifyPhoneRegisterCommand request, CancellationToken cancellationToken)
2025-12-06T14:11:52.880955445Z [inf]     at MediatR.Wrappers.RequestHandlerWrapperImpl`2.<>c__DisplayClass1_0.<Handle>g__Handler|0(CancellationToken t)
2025-12-06T14:11:52.880956247Z [inf]     at Core.Utilities.Interceptors.MethodInterception.Intercept(IInvocation invocation) in /src/Core/Utilities/Interceptors/MethodInterception.cs:line 16
2025-12-06T14:11:52.880968916Z [inf]     at Castle.DynamicProxy.AbstractInvocation.Proceed()
2025-12-06T14:11:52.880971005Z [inf]  [AUTOFAC] ConnectionString from config: Host=postgres.railway.internal;Port=5432;Database=...
2025-12-06T14:11:52.880976495Z [inf]  2025-12-06 14:11:52.677 +00:00 [INF] [VerifyPhoneRegister] Verifying OTP for phone: 05421396386
2025-12-06T14:11:52.880977930Z [inf]     at Core.Utilities.Interceptors.MethodInterception.Intercept(IInvocation invocation) in /src/Core/Utilities/Interceptors/MethodInterception.cs:line 15
2025-12-06T14:11:52.880983655Z [inf]     at Castle.DynamicProxy.AbstractInvocation.Proceed()
2025-12-06T14:11:52.881809671Z [inf]     at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.InvokeInnerFilterAsync()
2025-12-06T14:11:52.881814624Z [inf]  --- End of stack trace from previous location ---
2025-12-06T14:11:52.881818955Z [inf]     at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeNextResourceFilter>g__Awaited|25_0(ResourceInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)
2025-12-06T14:11:52.881870337Z [inf]     at MediatR.Wrappers.RequestHandlerWrapperImpl`2.Handle(IRequest`1 request, IServiceProvider serviceProvider, CancellationToken cancellationToken)
2025-12-06T14:11:52.881875789Z [inf]     at MediatR.Mediator.Send[TResponse](IRequest`1 request, CancellationToken cancellationToken)
2025-12-06T14:11:52.881881061Z [inf]     at WebAPI.Controllers.AuthController.VerifyPhoneRegister(VerifyPhoneRegisterRequest request) in /src/WebAPI/Controllers/AuthController.cs:line 237
2025-12-06T14:11:52.881886362Z [inf]     at Microsoft.AspNetCore.Mvc.Infrastructure.ActionMethodExecutor.TaskOfIActionResultExecutor.Execute(ActionContext actionContext, IActionResultTypeMapper mapper, ObjectMethodExecutor executor, Object controller, Object[] arguments)
2025-12-06T14:11:52.881891992Z [inf]     at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.<InvokeActionMethodAsync>g__Awaited|12_0(ControllerActionInvoker invoker, ValueTask`1 actionResultValueTask)
2025-12-06T14:11:52.881897742Z [inf]     at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.<InvokeNextActionFilterAsync>g__Awaited|10_0(ControllerActionInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)
2025-12-06T14:11:52.881903090Z [inf]     at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.Rethrow(ActionExecutedContextSealed context)
2025-12-06T14:11:52.881908632Z [inf]     at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.Next(State& next, Scope& scope, Object& state, Boolean& isCompleted)
2025-12-06T14:11:52.884605071Z [inf]     at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.Next(State& next, Scope& scope, Object& state, Boolean& isCompleted)
2025-12-06T14:11:52.884606989Z [inf]     at Microsoft.AspNetCore.Authentication.AuthenticationMiddleware.Invoke(HttpContext context)
2025-12-06T14:11:52.884612084Z [inf]     at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.InvokeFilterPipelineAsync()
2025-12-06T14:11:52.884614466Z [inf]     at Core.Extensions.ExceptionMiddleware.InvokeAsync(HttpContext httpContext) in /src/Core/Extensions/ExceptionMiddleware.cs:line 28
2025-12-06T14:11:52.884618302Z [inf]  --- End of stack trace from previous location ---
2025-12-06T14:11:52.884621069Z [inf]  System.AggregateException: One or more errors occurred. (An error occurred while saving the entity changes. See the inner exception for details.)
2025-12-06T14:11:52.884625701Z [inf]     at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeAsync>g__Awaited|17_0(ResourceInvoker invoker, Task task, IDisposable scope)
2025-12-06T14:11:52.884627354Z [inf]   ---> Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while saving the entity changes. See the inner exception for details.
2025-12-06T14:11:52.884632954Z [inf]     at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeAsync>g__Awaited|17_0(ResourceInvoker invoker, Task task, IDisposable scope)
2025-12-06T14:11:52.884634783Z [inf]   ---> Npgsql.PostgresException (0x80004005): 23505: duplicate key value violates unique constraint "PK_Users"
2025-12-06T14:11:52.884638583Z [inf]     at Microsoft.AspNetCore.Localization.RequestLocalizationMiddleware.Invoke(HttpContext context)
2025-12-06T14:11:52.884644724Z [inf]     at Microsoft.AspNetCore.Authorization.AuthorizationMiddleware.Invoke(HttpContext context)
2025-12-06T14:11:52.884647129Z [inf]     at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.Rethrow(ResourceExecutedContextSealed context)
2025-12-06T14:11:52.888431587Z [inf]     at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
2025-12-06T14:11:52.888461320Z [inf]  
2025-12-06T14:11:52.888468251Z [inf]  DETAIL: Detail redacted as it may contain sensitive data. Specify 'Include Error Detail' in the connection string to include this information.
2025-12-06T14:11:52.888474716Z [inf]     at Npgsql.Internal.NpgsqlConnector.ReadMessageLong(Boolean async, DataRowLoadingMode dataRowLoadingMode, Boolean readingNotifications, Boolean isReadingPrependedMessage)
2025-12-06T14:11:52.888482136Z [inf]     at System.Runtime.CompilerServices.PoolingAsyncValueTaskMethodBuilder`1.StateMachineBox`1.System.Threading.Tasks.Sources.IValueTaskSource<TResult>.GetResult(Int16 token)
2025-12-06T14:11:52.888488987Z [inf]     at Npgsql.NpgsqlDataReader.NextResult(Boolean async, Boolean isConsuming, CancellationToken cancellationToken)
2025-12-06T14:11:52.888495413Z [inf]     at Npgsql.NpgsqlDataReader.NextResult(Boolean async, Boolean isConsuming, CancellationToken cancellationToken)
2025-12-06T14:11:52.888501893Z [inf]     at Npgsql.NpgsqlCommand.ExecuteReader(Boolean async, CommandBehavior behavior, CancellationToken cancellationToken)
2025-12-06T14:11:52.888508494Z [inf]     at Npgsql.NpgsqlCommand.ExecuteReader(Boolean async, CommandBehavior behavior, CancellationToken cancellationToken)
2025-12-06T14:11:52.888514803Z [inf]     at Npgsql.NpgsqlCommand.ExecuteDbDataReaderAsync(CommandBehavior behavior, CancellationToken cancellationToken)
2025-12-06T14:11:52.888521147Z [inf]     at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
2025-12-06T14:11:52.888528242Z [inf]     at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
2025-12-06T14:11:52.890780258Z [inf]     at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
2025-12-06T14:11:52.890788658Z [inf]     at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
2025-12-06T14:11:52.890791820Z [inf]    Exception data:
2025-12-06T14:11:52.890797978Z [inf]     at Microsoft.EntityFrameworkCore.Storage.RelationalDatabase.SaveChangesAsync(IList`1 entries, CancellationToken cancellationToken)
2025-12-06T14:11:52.890798069Z [inf]      Severity: ERROR
2025-12-06T14:11:52.890805691Z [inf]     at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
2025-12-06T14:11:52.890806971Z [inf]      SqlState: 23505
2025-12-06T14:11:52.890811794Z [inf]      MessageText: duplicate key value violates unique constraint "PK_Users"
2025-12-06T14:11:52.890815543Z [inf]      Detail: Detail redacted as it may contain sensitive data. Specify 'Include Error Detail' in the connection string to include this information.
2025-12-06T14:11:52.890819333Z [inf]      SchemaName: public
2025-12-06T14:11:52.890824293Z [inf]      TableName: Users
2025-12-06T14:11:52.890828602Z [inf]      ConstraintName: PK_Users
2025-12-06T14:11:52.890832646Z [inf]      File: nbtinsert.c
2025-12-06T14:11:52.890836288Z [inf]      Line: 666
2025-12-06T14:11:52.890843616Z [inf]      Routine: _bt_check_unique
2025-12-06T14:11:52.890847471Z [inf]     --- End of inner exception stack trace ---
2025-12-06T14:11:52.890851972Z [inf]     at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
2025-12-06T14:11:52.890860342Z [inf]     at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
2025-12-06T14:11:52.892909233Z [inf]     at Core.Utilities.Interceptors.MethodInterception.Intercept(IInvocation invocation) in /src/Core/Utilities/Interceptors/MethodInterception.cs:line 15
2025-12-06T14:11:52.892937371Z [inf]     at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
2025-12-06T14:11:52.892946004Z [inf]     at Npgsql.EntityFrameworkCore.PostgreSQL.Storage.Internal.NpgsqlExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
2025-12-06T14:11:52.892951917Z [inf]     at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
2025-12-06T14:11:52.892956086Z [inf]     at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
2025-12-06T14:11:52.892960257Z [inf]     at Business.Handlers.Authorizations.Commands.VerifyPhoneRegisterCommand.VerifyPhoneRegisterCommandHandler.Handle(VerifyPhoneRegisterCommand request, CancellationToken cancellationToken) in /src/Business/Handlers/Authorizations/Commands/VerifyPhoneRegisterCommand.cs:line 145
2025-12-06T14:11:52.892965428Z [inf]     --- End of inner exception stack trace ---
2025-12-06T14:11:52.892970147Z [inf]     at System.Threading.Tasks.Task.ThrowIfExceptional(Boolean includeTaskCanceledExceptions)
2025-12-06T14:11:52.892974629Z [inf]     at System.Threading.Tasks.Task.Wait(Int32 millisecondsTimeout, CancellationToken cancellationToken)
2025-12-06T14:11:52.892979274Z [inf]     at Core.Utilities.Interceptors.MethodInterception.Intercept(IInvocation invocation) in /src/Core/Utilities/Interceptors/MethodInterception.cs:line 16
2025-12-06T14:11:52.892983826Z [inf]     at Castle.DynamicProxy.AbstractInvocation.Proceed()
2025-12-06T14:11:52.894419510Z [inf]     at Castle.DynamicProxy.AbstractInvocation.Proceed()
2025-12-06T14:11:52.894425968Z [inf]     at Core.Utilities.Interceptors.MethodInterception.Intercept(IInvocation invocation) in /src/Core/Utilities/Interceptors/MethodInterception.cs:line 15
2025-12-06T14:11:52.894430269Z [inf]     at Castle.DynamicProxy.AbstractInvocation.Proceed()
2025-12-06T14:11:52.894435192Z [inf]     at Castle.Proxies.IRequestHandler`2Proxy_19.Handle(VerifyPhoneRegisterCommand request, CancellationToken cancellationToken)
2025-12-06T14:11:52.894440097Z [inf]     at MediatR.Wrappers.RequestHandlerWrapperImpl`2.<>c__DisplayClass1_0.<Handle>g__Handler|0(CancellationToken t)
2025-12-06T14:11:52.894445627Z [inf]     at MediatR.Wrappers.RequestHandlerWrapperImpl`2.Handle(IRequest`1 request, IServiceProvider serviceProvider, CancellationToken cancellationToken)
2025-12-06T14:11:52.894450633Z [inf]     at MediatR.Mediator.Send[TResponse](IRequest`1 request, CancellationToken cancellationToken)
2025-12-06T14:11:52.894456236Z [inf]     at WebAPI.Controllers.AuthController.VerifyPhoneRegister(VerifyPhoneRegisterRequest request) in /src/WebAPI/Controllers/AuthController.cs:line 237
2025-12-06T14:11:52.894461233Z [inf]     at Microsoft.AspNetCore.Mvc.Infrastructure.ActionMethodExecutor.TaskOfIActionResultExecutor.Execute(ActionContext actionContext, IActionResultTypeMapper mapper, ObjectMethodExecutor executor, Object controller, Object[] arguments)
2025-12-06T14:11:52.894467067Z [inf]     at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.<InvokeActionMethodAsync>g__Awaited|12_0(ControllerActionInvoker invoker, ValueTask`1 actionResultValueTask)
2025-12-06T14:11:52.894472323Z [inf]     at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.<InvokeNextActionFilterAsync>g__Awaited|10_0(ControllerActionInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)
2025-12-06T14:11:52.894477263Z [inf]     at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.Rethrow(ActionExecutedContextSealed context)
2025-12-06T14:11:52.896221066Z [inf]     at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.Next(State& next, Scope& scope, Object& state, Boolean& isCompleted)
2025-12-06T14:11:52.896226523Z [inf]     at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.InvokeInnerFilterAsync()
2025-12-06T14:11:52.896233571Z [inf]  --- End of stack trace from previous location ---
2025-12-06T14:11:52.896239281Z [inf]     at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeNextResourceFilter>g__Awaited|25_0(ResourceInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)
2025-12-06T14:11:52.896244537Z [inf]     at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.Rethrow(ResourceExecutedContextSealed context)
2025-12-06T14:11:52.896250508Z [inf]     at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.Next(State& next, Scope& scope, Object& state, Boolean& isCompleted)
2025-12-06T14:11:52.896256259Z [inf]     at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.InvokeFilterPipelineAsync()
2025-12-06T14:11:52.896262033Z [inf]  --- End of stack trace from previous location ---
2025-12-06T14:11:52.896266787Z [inf]     at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeAsync>g__Awaited|17_0(ResourceInvoker invoker, Task task, IDisposable scope)
2025-12-06T14:11:52.896271896Z [inf]     at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeAsync>g__Awaited|17_0(ResourceInvoker invoker, Task task, IDisposable scope)
2025-12-06T14:11:52.896276821Z [inf]     at Microsoft.AspNetCore.Localization.RequestLocalizationMiddleware.Invoke(HttpContext context)
2025-12-06T14:11:52.896282286Z [inf]     at Microsoft.AspNetCore.Authorization.AuthorizationMiddleware.Invoke(HttpContext context)
2025-12-06T14:11:52.896291099Z [inf]     at Microsoft.AspNetCore.Authentication.AuthenticationMiddleware.Invoke(HttpContext context)
2025-12-06T14:11:52.896296029Z [inf]     at Core.Extensions.ExceptionMiddleware.InvokeAsync(HttpContext httpContext) in /src/Core/Extensions/ExceptionMiddleware.cs:line 28
2025-12-06T14:11:52.897931998Z [inf]  2025-12-06 14:11:52.697 +00:00 [ERR] Unhandled exception: AggregateException - One or more errors occurred. (An error occurred while saving the entity changes. See the inner exception for details.)